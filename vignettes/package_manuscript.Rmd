---
title: "PCreg: An R Package for Nested Principal Component Climate Reconstructions"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Climate Reconstruction Using pcreg}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(pcreg)
```

## Abstract
We present pcreg, a new software package for the development of nested principal component regression climate reconstructions from tree rings in the R. The use of the R statistical programming environment for these reconstructions can improve replicability and transparency, which are both crucial to the goals of the paleoclimate community. 

## Introduction

This package is for the development of nested principal component regression reconstructions from tree ring data. See the following publications for examples and detailed descriptions and uses of this method: cook 1999, etc, etc.

Due to the time consuming nature of data collection and the specialized statistical methods used for the analysis of tree-ring data, the paleoclimate community often relies on the open sharing of data and software. This is evidenced by the popularity and frequent use of resources such as the International Tree Ring Data Bank (ITRDB, NOAA), the Dendrochronology Program Library (Richard Holmes/University of Arizona), the Lamont-Doherty dendrochronology software repository (website), and R packages such as dplR (Bunn 2008) and treeclim (Zang 2015). 

Incredible efforts have been made over the last 40 years in the development of statistical techniques for tree-ring data analysis and associated software which allow users to standardize series, develop chronologies, cross-date, correlate to climate field, estimate climate reconstructions, and much more. These programs revolutionized dendrochronolgy, and their free availability to the community is a testament to the importance of open commucication and collaboration in science. Many of these programs utilize an interactive user interface and are based in FORTRAN, which is a powerful and verstile language well suited to scientific computing. They efficiently perform complex calculations, preventing the user from having to program them.

R is a similarly powerful statistical programming language and software environment which has several advantages over common FORTRAN or MATLAB based programs. R is free and open source, in addition to being extremely versatile in its application for many different types of statisical analyses, data processing, simulations, etc. It has a large global user-base across a wide variety of disciplines, many of whom are actively engaged in various wikis, newsletters, and web forums (such as stack exchange) which create a community of support through active dialogue and problem solving. 

- replicability and transparency - scripts vs log files
- documentation
- all platforms, documentation, testing (CRAN)


### Functions

There are three main functions in the pcreg package for making reconstruction estimates: load_clim(), eval_clim() and pcreg().

* load_clim() takes monthly climate data and selects individual months, averages, or sums across selected months (-12:12). Input is a dataframe or matrix object containing climate data in either 13 column (columns are year and months 1:12) or long (columns are year, month, and values) formats. Output is an S3 list which includes the climate variable and the ar model if prewhitening is indicated.

* eval_clim selects chronologies for inclusion in the PC regression based on correlation with the climate variable.Inputs are the S3 list as created by the load_clim() function and a dataframe containing tree-ring chronology data in which each column is a chronology. Output includes a dataframe of correlation coefficients for each chronology and the target climate variable, a dataframe of chronologies selected for inclusion in the model, and a dataframe containing the start and end year of each selected chronology. 

* pcreg() calculates principal compenent eigenvectors and linear regression model estimates, then makes predictions for each nest and splices them together. Output includes: climate reconstruction, model statistics and validation statistics for each nest, PCA objects for each nest, and lm objects for each nest.  

Additional functions are used to retrieve metadata from ITRDB downloaded tree ring files, filter tree rings for inclusion based on spatial location or correlation to target climate, and to upload and summarize climate data from various formats. These include:

* parse_json - write descriptions for each of these...
* filter_spat
* filter_cor
* get_clim


## Worked Example
### Data
Tree ring data downloaded form the ITRDB using the FedData package (include code to procure? used a bounding box)
Climate data is USGS Streamflow gage data for gauge #XXX, downloaded from XXX 

### Code

### Results

### Comparison to PCreg


## Comparison with PCreg?
### Citations

